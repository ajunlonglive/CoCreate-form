!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CoCreate=e():(t.CoCreate=t.CoCreate||{},t.CoCreate.form=e())}(this,(function(){return(()=>{var t={515:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r});const o={attribute:"data-actions",actions:{},selectedStage:[],stageIndex:0,selectedElement:null,completedEventName:"completedEvent",__init:function(){this.actionButtonEvent()},actionButtonEvent:function(){const t=this;document.addEventListener("click",(function(e){let n=e.target;if(n.getAttribute("data-actions")||(n=e.target.closest("[data-actions]")),!n)return;e.preventDefault();let o=(n.getAttribute(t.attribute)||"").replace(/\s/g,"").split(",");0!=o.length&&(t.stageIndex=0,t.selectedStage=o,t.selectedElement=n,t.__runActionFunc())}))},init:function({action:t,callback:e,endEvent:n}){this.registerEvent(t,e,null,n)},registerEvent:function(t,e,n,o){if(this.actions[t])return;this.actions[t]={key:t,runFunc:e,instance:n||window,endEvent:o};for(let e in this.actions)if(e!=t&&this.actions[e].endEvent===o)return;const r=this;document.addEventListener(o,(function(t){r.__nextAction(o,t.detail)}))},__runActionFunc:function(t){if(this.stageIndex>=this.selectedStage.length)return void(this.stageIndex==this.selectedStage.length&&this.__runAtag(this.selectedElement));const e=this.selectedStage[this.stageIndex],n=this.actions[e];if(n)n.runFunc?n.runFunc.call(null,this.selectedElement,t):this.__nextAction(n.endEvent,{});else{"next"===this.__runSpecialAction(e,t)&&this.__moveNextAction()}},__nextAction:function(t,e){const n=this.selectedStage[this.stageIndex];n&&t===this.actions[n].endEvent&&this.__moveNextAction(e)},__runAtag:function(t){t.querySelector("a")},__runSpecialAction:function(t,e){let n=/(\w+)\{([a-zA-Z0-9_ \-#$.]+)\}/gm.exec(t);if(!n||n.length<3)return"next";let o=n[1],r=n[2].trim();if(!r)return"next";const a=this;switch(o){case"event":document.addEventListener(r,(t=>{a.__moveNextAction(t)}),{once:!0});break;case"timeout":parseInt(r)>0&&setTimeout((function(){a.__moveNextAction(e)}),parseInt(r));break;case"action":let t=document.querySelector(r);t&&t.click();break;default:return"next"}},__moveNextAction:function(t){this.stageIndex++,this.__runActionFunc(t)}};o.__init();const r=o},15:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(446),n(965)],void 0===(r=function(t,e){return function(t,e,n){return{socket:null,setSocket:function(t){this.socket=t},readDocumentList:async function(t){if(!t)return!1;let n=e.getCommonParams();if(!t.collection)return!1;n={...n,...t},e.generateSocketClient(t.namespace,t.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(t){return null}},createDocument:async function(n){if(null===n)return!1;let o=e.getCommonParamsExtend(n),r={...n,...o},a=n.data||{};a.organization_id||(a.organization_id=t.config.organization_Id),n.data&&(a={...a,...n.data}),r.data=a;const i=e.generateSocketClient(n.namespace,n.room);let c=this.socket.send("createDocument",r,i);try{return await this.socket.listenAsync(c)}catch(t){return null}},updateDocument:async function(t){if(!t)return!1;if(t.document_id&&!n.checkDocumentId(t.document_id))return!1;let o=e.getCommonParamsExtend(t),r={...t,...o};if("object"==typeof t.data&&(r.set=t.data),Array.isArray(t.delete_fields)&&(r.unset=t.delete_fields),!r.set&&!r.unset)return!1;!1===t.broadcast&&(r.broadcast=!1),void 0===t.broadcast_sender&&(r.broadcast_sender=!0);const a=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("updateDocument",r,a);try{return await this.socket.listenAsync(i)}catch(t){return null}},readDocument:async function(t){if(null===t)return null;if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o},a=this.socket.send("readDocument",r);try{return e.generateSocketClient(t.namespace,t.room),await this.socket.listenAsync(a)}catch(t){return null}},deleteDocument:async function(t){if(!t||!n.checkDocumentId(t.document_id))return null;let o=e.getCommonParamsExtend(t),r={...t,...o};const a=e.generateSocketClient(t.namespace,t.room);let i=this.socket.send("deleteDocument",r,a);try{return await this.socket.listenAsync(i)}catch(t){return null}},exportCollection:function(t){if(null===t)return;let n=e.getCommonParamsExtend(t);n.collection=t.collection,n.export_type=t.export_type,n.metadata=t.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof t.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((t=>t===r)))return;let a=e.getCommonParamsExtend(n);a.collection=n.collection,a.import_type=r,this.socket.send("importDB",a),this.socket.sendFile(o)},listen:function(t,e){this.socket.listen(t,e)},listenAsync:function(t){return this.socket.listenAsync(t)},createSocket:function(t,e){e?(this.socket.create({namespace:e,room:null,host:t}),this.socket.setGlobalScope(e)):this.socket.create({namespace:null,room:null,host:t})},...n}}(window,t,e)}.apply(e,o))||(t.exports=r)},611:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(585),n(15)],void 0===(r=function(t,e){return function(t,e,n){if(t){let t=window.CoCreateCrudSocket;t||(t=new e("ws"),window.CoCreateCrudSocket=t),n.setSocket(t),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,t,e)}.apply(e,o))||(t.exports=r)},965:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function t(e,n){e=e||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],t(e[o],n[o]));return Object.assign(e||{},n),e}function e(t,e){if(!e)return t;let n=e.split("."),o=t;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(t,e){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(t);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);e[o]&&Array.isArray(e[o])||(e[o]=[]),e[o][r]=e[t],delete e[t],t=o}}catch{}return t}function o(t,e){try{if(!t||!e)return null;if(e[t])return e[t];let o=t.split("."),r={...e};for(var n=0;n<o.length&&r;n++)r=r[o[n]];return r}catch{return null}}function r(t){return!!t&&t.constructor===Object}function a(t){return!!t&&t.constructor===Array}function i(o){let r=Object.keys(o),a={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=e(o[r],r);delete o[r],a=t(a,n)}else a[r]=o[r]})),a}function c(t){let e=Object.keys(t),n={};return e.forEach((e=>{let o=t[e];if(r(t[e])){let o=c(t[e]);Object.keys(o).forEach((t=>{let r=o[t];n[t=e+"."+t]=r}))}else a(o)?o.forEach(((t,o)=>{n[`${e}[${o}]`]=t})):n[e]=t[e]})),n}function s(t){if(t)return{collection:t.getAttribute("data-collection"),document_id:t.getAttribute("data-document_id"),name:t.getAttribute("name")}}function l(t){if(!t)return{};let e=h(t),n=d(t),o=u(t),r=m(t);return f(t),{is_realtime:e,is_save:n,is_read:o,is_update:r}}const u=t=>p(t,"data-read_value"),d=t=>p(t,"data-save_value"),m=t=>p(t,"data-update_value"),f=t=>p(t,"data-flat"),h=t=>!!t&&"false"!=t.getAttribute("data-realtime");function p(t,e){return!!t&&"false"!==t.getAttribute(e)}function g(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)}function _(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function y(t){const{collection:e,document_id:n,name:o}=s(t);return!(_(e)||_(o)||!("INPUT"===t.tagName&&["text","email","tel","url"].includes(t.type)||"TEXTAREA"===t.tagName)||!o||!h(t)||"true"===t.getAttribute("data-unique")||"password"===t.type||!u(t))}function b(t){try{return!!t&&"null"!==t.toLowerCase()}catch(t){return!1}}return{decodeObject:i,encodeObject:c,getAttr:s,getFlagAttr:l,isRealtimeAttr:h,isReadAttr:u,isSaveAttr:d,isUpdateAttr:m,isFlatAttr:f,checkValue:g,isCRDT:y,checkDocumentId:b,getValueByPath:o}}()}.apply(e,[]))||(t.exports=n)},366:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>r}),window.profiler={},window.counter=0,window.counter2=0,window.targets={},window.attributeName={},Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),n=e.length;--n>=0&&e.item(n)!==this;);return n>-1});const o={initTasks:new Map,attrTasks:new Map,rules:new Map,rulesArray:[],__init:function(){const t=this;new MutationObserver(((e,n)=>t.__callback(e,n))).observe(document.body,{attributes:!0,childList:!0,subtree:!0,characterData:!1,attributeOldValue:!0,characterData:!0})},init:function({observe:t,include:e,exclude:n,attributes:o,name:r,callback:a}){t.some((t=>"childList"==t))&&this.initTasks.set(a,{observe:t,include:e,exclude:n,attributes:o,name:r}),t.some((t=>"attributes"==t))&&this.attrTasks.set(a,{observe:t,include:e,exclude:n,attributes:o,name:r})},remove:function(t){this.initTasks.delete(t),this.attrTasks.delete(t)},addRule:function({include:t,exclude:e,name:n}){this.rules.set(n,{include:t,exclude:e}),this.rulesArray=Array.from(this.rules)},removeRule:function({name:t}){this.rules.delete(t),this.rulesArray=Array.from(this.rules)},__callback:function(t,e){window.counter++;for(let e of t)"childList"==e.type&&e.addedNodes.length>0&&this.__initCallback(e),"attributes"==e.type&&this.__attrCallback(e)},__initCallback:function(t){this.initTasks.forEach((({observe:e,include:n,exclude:o,attributes:r,name:a},i)=>{t.addedNodes.forEach((e=>{e.tagName&&(!n||e.matches(n)||e.querySelector(n))&&(o&&(e.matches(o)||e.querySelector(o))||i.apply(null,[{type:t.type,target:e,isRemoved:!1}]))})),t.removedNodes.forEach((e=>{e.tagName&&(!n||e.matches(n)||e.querySelector(n))&&(o&&(e.matches(o)||e.querySelector(o))||i.apply(null,[{type:t.type,target:e,isRemoved:!0}]))}))}))},__attrCallback:function(t){for(let[e,{include:n,exclude:o}]of this.rulesArray){if(n&&!t.target.matches(n))return;if(o&&t.target.matches(o))return}this.attrTasks.forEach((({observe:e,include:n,exclude:o,attributes:r,name:a},i)=>{if((!r||!t.attributeName||r.includes(t.attributeName))&&(!n||t.target.matches(n))&&(!o||!t.target.matches(o))&&t.attributeName){t.target.getAttribute(t.attributeName)!=t.oldValue&&i.apply(null,[t])}}))},setInitialized:function(t,e){t["co_initialized_"+(e=e||"")]=!0},getInitialized:function(t,e){return!!t["co_initialized_"+(e=e||"")]}};o.__init();const r=o},446:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(t){function e(){let e={};return t&&t.config&&(e=t.config),{apiKey:e.apiKey,organization_id:e.organization_Id}}function n(e){let n={};return t&&t.config&&(n=t.config),{apiKey:e.apiKey||n.apiKey,organization_id:e.organization_id||n.organization_Id}}function o(e,n){let o={};t&&t.config&&(o=t.config);let r=e||o.organization_Id,a=n||"";return a?`${r}/${a}`:r}return{getCommonParams:e,getCommonParamsExtend:n,generateSocketClient:o}}(window)}.apply(e,[]))||(t.exports=n)},585:function(t,e,n){var o,r;"undefined"!=typeof self&&self,o=[n(446),n(212)],void 0===(r=function(t,e){return function(t,e,n,o,r){class a{constructor(t="crud"){this.prefix=t||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(t){this.globalScope=`${this.prefix}/${t}`}getGlobalScope(){return this.globalScope}create(t){const{namespace:r,room:a}=t,i=this.getKey(r,a);let c,s=this;if(r&&this.setGlobalScope(r),this.sockets.get(i))return void(c=this.sockets.get(i));let l=e.location.protocol;"about:"===e.location.protocol&&(l=e.parent.location.protocol,t.host||(t.host=e.parent.location.host));let u="http:"===l?"ws":"wss";const d=t.port?t.port:8088;let m=`${u}://${e.location.host}:${d}/${i}`;t.host&&(m=t.host.includes("://")?`${t.host}/${i}`:t.host.includes(":")?`${u}://${t.host}/${i}`:`${u}://${t.host}:${d}/${i}`);try{let t=null;e.localStorage&&(t=e.localStorage.getItem("token")),c=new n(m,t),c.cocreate_connected=!1,this.sockets.set(i,c)}catch(t){return}c.onopen=function(t){c.cocreate_connected||(c.cocreate_connected=!0),(s.messageQueue.get(i)||[]).forEach((t=>c.send(JSON.stringify(t)))),s.messageQueue.set(i,[])},c.onclose=function(e){switch(e.code){case 1e3:break;default:s.destroy(c,i),s.reconnect(c,t)}},c.onerror=function(e){s.destroy(c,i),s.reconnect(c,t)},c.onmessage=function(t){try{if(e.Blob&&t.data instanceof o)return void s.saveFile(t.data);let n=JSON.parse(t.data);if(n.data&&(n.data.uid&&s.__fireEvent(n.data.uid,n.data),n.data.event))return void s.__fireEvent(n.data.event,n.data);n.action;const r=s.listeners.get(n.action);if(!r)return;r.forEach((t=>{t(n.data,i)}))}catch(t){}}}__fireEvent(t,n){if(e.CustomEvent){var o=new e.CustomEvent(t,{detail:n});e.document.dispatchEvent(o)}else process.emit(t,n)}send(t,e,n){const o=r.generate(),a={action:t,data:{...e,uid:o}},i=this.getKeyByRoom(n),c=this.getByRoom(n);return c&&c.cocreate_connected?c.send(JSON.stringify(a)):this.messageQueue.get(i)?this.messageQueue.get(i).push(a):this.messageQueue.set(i,[a]),o}sendFile(t,e){const n=this.getByRoom(e);n&&n.send(t)}listen(t,e){this.listeners.get(t)?this.listeners.get(t).push(e):this.listeners.set(t,[e])}reconnect(t,e){let n=this;setTimeout((function(){n.create(e)}),1e3)}destroy(t,e){t&&(t.onerror=t.onopen=t.onclose=null,t.close(),t=null),this.sockets.get(e)&&this.sockets.delete(e)}destroyByKey(t){let e=this.sockets.get(t);e&&this.destroy(e,t)}getKey(t,e){let n=`${this.prefix}`;return t&&""!=t&&(n+=e&&""!=e?`/${t}/${e}`:`/${t}`),n}getByRoom(t){let e=this.getKeyByRoom(t);return this.sockets.get(e)}getKeyByRoom(t){let e=this.globalScope;return t&&(e=`${this.prefix}/${t}`),e}saveFile(t){if(e.document){const o=this.saveFileName||"downloadFile";var n=e.document.createElement("a");e.document.body.appendChild(n),n.style="display: none";let r=window.URL.createObjectURL(t);n.href=r,n.download=o,n.click(),e.URL.revokeObjectURL(r),this.saveFileName=""}}listenAsync(t){return new Promise(((n,o)=>{let r=setTimeout((()=>{clearTimeout(r),n(null)}),5e3);e.document?e.document.addEventListener(t,(function(t){n(t.detail)}),{once:!0}):process.once(t,(t=>{n(t)}))}))}}return a}(0,window,WebSocket,Blob,e)}.apply(e,o))||(t.exports=r)},727:(t,e,n)=>{"use strict";function o(t,e,n){if(e){if(t.classList.contains(e))return t;let n=t.parentNode;for(;null!=n&&n.classList;){if(n.classList.contains(e))return n;n=n.parentNode}}else if(n){if(n.every((e=>t.attributes.hasOwnProperty(e))))return t;let e=t.parentNode;for(;null!=e&&e.attributes;){if(n.every((t=>e.attributes.hasOwnProperty(t))))return e;e=e.parentNode}}return!1}function r(t){try{let e=JSON.parse(t);return"object"==typeof e&&null!=e}catch(t){return!1}}function a(t){return t.getAttributeNames().reduce(((e,n)=>(e[n]=t.getAttribute(n),e)),{})}function i(t){return!!t&&!/{{\s*([\w\W]+)\s*}}/g.test(t)}function c(t){let e=[{document,window}];for(let t of document.querySelectorAll("iframe")){let n=t.contentDocument||t.contentWindow.document,o=t.contentWindow;e.push({document:n,window:o,frameElement:t})}let n=new Set;for(let o of e){let e=t(o);e&&"function"==typeof e[Symbol.iterator]?e.forEach((t=>n.add(t))):e&&n.add(e)}return Array.from(n)}function s(t){let e=[];do{if(!t||!t.tagName)return!1;let n=t.tagName.toLowerCase();if(t.id&&"BODY"!==t.tagName&&(n+="#"+t.id),t.classList.length&&"BODY"!==t.tagName&&t.classList.forEach((t=>{-1===t.indexOf(":")&&(n+="."+t)})),"BODY"!==t.tagName&&t.parentNode){let e=Array.prototype.indexOf.call(t.parentNode.children,t);n+=`:nth-child(${e+1})`}e.unshift(n),t=t.parentNode}while("HTML"!==t.tagName);return e.join(" > ")}function l(){let t=window;for(;t!==window.parent;)t=window.parent;return t}function u(t,e){let n;return c((t=>{t.document.contains(e)&&(n=t.frameElement)})),n}function d(t){let e=l;return t.forEach((t=>{e&&(e=e.querySelector(t))})),e}function*m(t,e){for(let n of t)n.selector&&e.matches(n.selector)&&(yield n)}function f(t,e,n,o){for(let r of m(o||window.elementConfig,t)){if(!0===r[e])return n(t,r);if(!1===r[e])return!1;if(void 0===r[e])continue;if(y(r[e]))return n(t,r,!0)}return!1}function h(t=10){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e+=(new Date).toTimeString().replace(/[\W_]+/g,"").substr(0,6)}function p(t){let e=(new DOMParser).parseFromString(t,"text/html");return e.head.children[0]?e.head.children[0]:e.body.children[0]}function g(t,e){return t.split(e).map((t=>t.trim()))}function _(t,e){return t.map((t=>t.trim())).join(e)}function y(t){try{document.createDocumentFragment().querySelector(t)}catch(t){return!1}return!0}function b(t,e){let n=[],o=(window,u(0,t)),r=s(o);return r&&n.unshift(r),e?{path:n,document:o||document}:n}n.r(e),n.d(e,{getParentFromElement:()=>o,isJsonString:()=>r,getAttributes:()=>a,checkValue:()=>i,allFrame:()=>c,cssPath:()=>s,getTopMostWindow:()=>l,findIframeFromElement:()=>u,getIframeFromPath:()=>d,configMatch:()=>m,configExecuter:()=>f,UUID:()=>h,parseTextToHtml:()=>p,splitBydelimiter:()=>g,joinBydelimiter:()=>_,isValidSelector:()=>y,getElementPath:()=>b,default:()=>A});const A={getElementPath:b,isValidSelector:y,joinBydelimiter:_,splitBydelimiter:g,parseTextToHtml:p,UUID:h,configExecuter:f,configMatch:m,getIframeFromPath:d,findIframeFromElement:u,getTopMostWindow:l,cssPath:s,allFrame:c,checkValue:i,getAttributes:a,isJsonString:r,getParentFromElement:o,logger:function(t="all"){if(!["all","error","warn","log","off"].includes(t))throw new Error("level must be one of all, error, warn, log or off");return{error:function(e){["all","error"].includes(t)},warn:function(e){["all","error","warn"].includes(t)},log:function(e){["all","error","warn","log"].includes(t)}}}}},212:function(t,e){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(t){const e={attribute:"data-uuid",init:function(e){if(!t.document)return;const n=e||t.document;if(!n.querySelectorAll)return;let o=n.querySelectorAll(`[${this.attribute}]`);const r=this;o.forEach((t=>{const e=parseInt(t.getAttribute(r.attribute))||36,n=r.generate(e);"INPUT"===t.tagName||"TEXTAREA"===t.tagName?t.value=n:t.innerHTML=n}))},generate:function(e=36){let n=(new Date).getTime(),o=t.performance&&t.performance.now&&1e3*t.performance.now()||0,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(e<=r.length)r=r.substr(0,e);else{let t=e-r.length,n="-xxxyyxxx",o=Math.floor(t/n.length);for(let t=0;t<o;t++)r+=n;o=t-o*n.length,r+=n.substr(0,o)}return r.replace(/[xy]/g,(function(t){var e=16*Math.random();return n>0?(e=(n+e)%16|0,n=Math.floor(n/16)):(e=(o+e)%16|0,o=Math.floor(o/16)),("x"==t?e:7&e|8).toString(16)}))}};return e.init(),e}(window)}.apply(e,[]))||(t.exports=n)},648:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o,r=(o=n(611))&&o.__esModule?o:{default:o};var a={disableAutoFill:function(t){"TEXTAREA"==t.tagName&&(t.value="",t.setAttribute("autocomplete","off")),t.hasAttribute("autocomplete")||t.setAttribute("autocomplete","off")},setAttribute:function(t){const{collection:e,document_id:n,name:o}=r.default.getAttr(t),a=t.getAttribute("data-realtime"),i=t.getAttribute("data-flat");t.querySelectorAll("[name], [data-pass_to]").forEach((function(t){t.parentNode.classList.contains("template")||(null==t.getAttribute("data-realtime")&&a&&t.setAttribute("data-realtime",a),t.getAttribute("name")&&!t.hasAttribute("data-collection")&&e&&t.setAttribute("data-collection",e),t.getAttribute("data-pass_to")&&!t.hasAttribute("data-pass_collection")&&e&&t.setAttribute("data-pass_collection",e),t.getAttribute("name")&&!t.getAttribute("data-document_id")&&n&&t.setAttribute("data-document_id",n),t.hasAttribute("data-document_id")||null==n||t.setAttribute("data-document_id",n),t.hasAttribute("data-flat")||null==i||t.setAttribute("data-flat",i))}))},checkFormValidate:function(t){return void 0===CoCreate.unique||CoCreate.unique.checkValidate(t)},isTemplateInput:function(t){if(t.classList.contains("template"))return!0;let e=t.parentNode;for(;e;){if(e.classList&&e.classList.contains("template"))return!0;e=e.parentNode}return!1},getFormData:function(t,e,n){let o={};if(!n)return{};return t.querySelectorAll(`[name][data-collection='${n}']`).forEach((t=>{let n=t.getAttribute("data-document_id")||"",r=t.getAttribute("name"),a=t.value||t.getAttribute("value");"_id"!==r&&r&&a&&e==n&&(o[r]=t.value)})),o},getParents:function(t,e="form"){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(t){for(var e=(this.document||this.ownerDocument).querySelectorAll(t),n=e.length;--n>=0&&e.item(n)!==this;);return n>-1});t&&t!==document;t=t.parentNode)if(t.matches(e))return t;return null},setDocumentIDOfElement:function(t,e){let n=t.getAttribute("data-document_id");n&&""!=n&&"pending"!=n||t.setAttribute("data-document_id",e)},getCOllections:function(t){let e=[];return t?(t.querySelectorAll("[name][data-collection]").forEach((t=>{let n=t.getAttribute("data-collection");n&&!e.includes(n)&&e.push(n)})),e):e}};e.default=a}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var a=e[o]={exports:{}};return t[o].call(a.exports,a,a.exports,n),a.exports}n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{"use strict";var t=o;t.default=void 0;var e=l(n(366)),r=l(n(727)),a=l(n(611)),i=l(n(515)),c=l(n(648)),s=l(n(212));function l(t){return t&&t.__esModule?t:{default:t}}const u={requestAttr:"data-document_request",selectors:[],modules:[],init:function({name:t,selector:e,callback:n}){this.modules.push({name:t,selector:e,callback:n}),e&&this.selectors.push(e)},get:function(){return{selectors:this.selectors}},checkID:function(t,e="data-document_id"){let n=t.getAttribute(e)||"";return!(""===n||"pending"===n||!r.default.checkValue(n))},request:async function({form:t,element:e,nameAttr:n,value:o}){!t&&e&&(t=e.closest("form")),t?await this.__requestDocumentIdOfForm(t):e&&(n=n||"name",await this.__requestDocumentId(e,n,o))},initElement:function(t){const e=t||document;if(!e.querySelectorAll)return;let n=e.querySelectorAll("form");0===n.length&&e!=document&&"FORM"===e.tagName&&(n=[e]),n.forEach((t=>{c.default.setAttribute(t),c.default.disableAutoFill(t)}))},__init:function(){const t=document.querySelectorAll("form");this.__initEvent(),t.forEach((t=>{c.default.setAttribute(t)}))},__initEvent:function(){const t=this;a.default.listen("deleteDocument",(function(t){const{metadata:e}=t})),document.addEventListener("clicked-submitBtn",(function(e){const{element:n}=e.detail;t.modules.forEach((({selector:t,callback:e})=>{e&&n.matches(t)&&e.call(null,n)}))}))},__deleteDocumentAction:function(t){const{collection:e,document_id:n}=a.default.getAttr(t);r.default.checkValue(e)&&r.default.checkValue(n)&&(a.default.deleteDocument({collection:e,document_id:n,metadata:"deleteDocument-action"}),document.dispatchEvent(new CustomEvent("deletedDocument",{detail:{}})))},__deleteDocumentsAction:function(t){const{collection:e,document_id:n}=a.default.getAttr(t),o=t.getAttribute("data-document_target");if(!o)return;const r=document.querySelectorAll(o);c.default.checkValue(e)&&(r.forEach((t=>{const n=t.getAttribute("data-document_id");a.default.checkValue(n)&&a.default.deleteDocument({collection:e,document_id:n,metadata:""})})),document.dispatchEvent(new CustomEvent("deletedDocuments",{detail:{}})))},__createDocumentAction:function(t){const e=t.closest("form");c.default.getCOllections(e).forEach((t=>{let n=c.default.getFormData(e,"",t);0==Object.keys(n).length&&n.constructor===Object||r.default.checkValue(t)&&(a.default.createDocument({collection:t,data:n,metadata:"createDocument-action",element:"empty"}),document.dispatchEvent(new CustomEvent("createdDocument",{detail:{}})))}))},__saveDocumentAction:function(t){const e=t.closest("form");if(!c.default.checkFormValidate(e))return void alert("Values are not unique");const n=this.selectors||[],o=e.querySelectorAll(n.join(","));let r=!1;for(var i=0;i<o.length;i++){let t=o[i];const{document_id:e,name:n}=a.default.getAttr(t);if(a.default.isSaveAttr(t))if(a.default.checkValue(e)){if(!a.default.isCRDT(t)){if(c.default.isTemplateInput(t))return;var s=new CustomEvent("clicked-submitBtn",{bubbles:!0,detail:{type:"submitBtn",element:t}});t.dispatchEvent(s)}}else n&&(r=!0)}r&&this.requestDocumentIdOfForm(e),document.dispatchEvent(new CustomEvent("savedDocument",{detail:{}}))},__saveDocument:async function(t){const e=t.closest("form");c.default.checkFormValidate(e)?(await this.requestDocumentIdOfForm(e),self.modules.forEach((({callback:t})=>{t.call(null,element)}))):alert("Values are not unique")},__requestDocumentId:async function(t,e="name",n=null){const{collection:o,name:r}=a.default.getAttr(t);if(!o||!r)return;const i=s.default.generate();t.setAttribute(this.requestAttr,i);let c=await a.default.createDocument({collection:o,element:i,metadata:""});c&&this.__receivedDocumentId(c)},__requestDocumentIdOfForm:async function(t){let e=this,n=t.querySelectorAll("[name], [data-pass_to]"),o=[];for(var r=0;r<n.length;r++){let i=n[r];if(i.parentNode.classList.contains("template"))continue;const c=i.getAttribute("data-collection")||i.getAttribute("data-pass_collection")||"";if(""!==c&&!o.includes(c)&&!e.checkID(i,"data-document_id")&&!e.checkID(i,"data-pass_document_id")){o.push(c);let e=await a.default.createDocument({collection:c,data:{},metadata:""});e&&this.setDocumentId(t,e)}}},setDocumentId:function(t,e){if(!e.document_id)return;const n=e.collection,o=e.document_id;if(t&&o){t.querySelectorAll(`[data-collection=${n}], [data-pass_collection=${n}]`).forEach((function(t){t.hasAttribute("name")&&!this.checkID(t)&&t.setAttribute("data-document_id",o),t.hasAttribute("data-pass_to")&&!this.checkID(t,"data-pass_document_id")&&(t.setAttribute("data-pass_document_id",o),t.parentNode.classList.contains("submitBtn")&&t.click())}))}},__setNewIdProcess:function(t,e,n){if(!t)return;t.removeAttribute(this.requestAttr);const o={document_id:e};n||this.checkID(t)||!t.hasAttribute("name")||t.setAttribute("data-document_id",e),n&&!this.checkID(t,"data-pass_document_id")&&t.hasAttribute("data-pass_to")&&(t.setAttribute("data-pass_document_id",e),t.parentNode.classList.contains("submitBtn")&&t.click());var r=new CustomEvent("set-document_id",{detail:o});t.dispatchEvent(r)},__receivedDocumentId:function(t){if(!t.document_id)return;let e=document.querySelector(`[${this.requestAttr}="${t.element}"]`);if(!e)return;let n=this;const o="FORM"===e.tagName?e:c.default.getParents(e,"form"),r=t.collection,a=t.document_id;if(o&&a){o.setAttribute("data-form_id",t.element);o.querySelectorAll(`[data-collection=${r}], [data-pass_collection=${r}]`).forEach((function(t){t.removeAttribute(n.requestAttr),t.hasAttribute("name")&&n.__setNewIdProcess(t,a),t.hasAttribute("data-pass_to")&&n.__setNewIdProcess(t,a,!0)}))}else e&&this.__setNewIdProcess(e,a)}};u.__init(),e.default.init({name:"CoCreateForm",observe:["addedNodes"],callback:t=>"FORM"===t.target.tagName&&u.initElement(t.target)}),i.default.init({action:"createDocument",endEvent:"createdDocument",callback:(t,e)=>{u.__createDocumentAction(t)}}),i.default.init({action:"deleteDocument",endEvent:"deletedDocument",callback:(t,e)=>{u.__deleteDocumentAction(t)}}),i.default.init({action:"deleteDocuments",endEvent:"deletedDocuments",callback:(t,e)=>{CoCreateDocument.__deleteDocumentsAction(t)}}),i.default.init({action:"saveDocument",endEvent:"savedDocument",callback:(t,e)=>{u.__saveDocumentAction(t)}});var d=u;t.default=d})(),o=o.default})()}));